import{j as e,o as u,r as c,_ as N,p as S,D as E,P as A,A as M,q as k,s as b,B as v,G as F,t as w,v as R}from"./vendor-BC_dpYi7.js";import{u as B,g as I,t as g,M as O}from"./TransactionUtils-DqeqH-hD.js";import{G as H}from"./ApiBase-DXA55t6X.js";import{f as x}from"./NumberUtils-DGiqd6yw.js";import"./index-BxcUTzTY.js";const L={sortable:!0},G=[{headerName:"Category",field:"categoryName"},{headerName:"Budget",field:"amount",minWidth:100,type:"rightAligned",valueFormatter:s=>x(parseInt(s.value??"0"),!1)},{headerName:"Amount",field:"amount",minWidth:100,type:"rightAligned",valueFormatter:s=>x(parseInt(s.value??"0"),!1)}],_=({transactionList:s})=>e.jsx(H,{rowHeight:25,styles:{height:"100%"},defaultColDef:L,colDefs:G,rowData:s,pagination:!1}),y=({height:s="250px",body:a,children:o,actionText:n,onClick:t})=>e.jsx("div",{className:"rounded",style:{height:s,boxShadow:"#3399F3 5px 5px 5px"},children:e.jsxs(u,{className:"h-100",children:[a?e.jsxs(u.Body,{className:"border-bottom text-center",children:[e.jsx(u.Title,{className:"text-black-50",children:a.title}),e.jsx(u.Text,{className:"p-1 display-6",children:a.text})]}):o,e.jsx(u.Footer,{className:"ms-auto border-0",children:e.jsx(u.Link,{href:"#",onClick:t,children:n})})]})}),K=({title:s,total:a,transactions:o})=>{const[n,t]=c.useState(!1),l=c.useCallback(()=>{t(!n)},[n]),r=x(a,!1);return e.jsxs(N,{isFlipped:n,children:[e.jsx(y,{body:{title:s,text:r},actionText:"Breakdown",onClick:l}),e.jsx(y,{actionText:"Summary",onClick:l,children:e.jsx(_,{transactionList:o})})]})},q=({children:s,...a})=>{const[o,n]=c.useState(!1);return c.useEffect(()=>{const t=requestAnimationFrame(()=>n(!0));return()=>{cancelAnimationFrame(t),n(!1)}},[]),o?e.jsx(S,{...a,children:s}):null},W=(s,a)=>({background:a?"unset":s?"lightblue":"lightgrey",display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gridTemplateRows:"repeat(2, 250px)",gap:"10px 5px",justifyItems:"stretch"}),z=({children:s,items:a,onDragEnd:o,isDropDisabled:n,isDragDisabled:t})=>{const l=c.useCallback(r=>{if(!r.destination)return;const d=Array.from(a),[m]=d.splice(r.source.index,1);d.splice(r.destination.index,0,m),o(d)},[a,o]);return e.jsx(E,{onDragEnd:l,children:e.jsx(q,{isDropDisabled:n,droppableId:"droppable",direction:"horizontal",children:(r,d)=>e.jsxs("div",{className:"p-2",ref:r.innerRef,style:W(d.isDraggingOver,n),...r.droppableProps,children:[a.map((m,j)=>e.jsx(A,{isDragDisabled:t,draggableId:m.id,index:j,children:i=>e.jsx("div",{ref:i.innerRef,...i.draggableProps,...i.dragHandleProps,children:s(m.data)})},m.id)),r.placeholder]})})})},P=({year:s,month:a})=>{const[o,n]=c.useState(!0),[t]=B(s,a),[l,r]=c.useState([]);c.useEffect(()=>{t&&r(I(t).map((i,p)=>({id:"item"+p,data:i})))},[t]);const d=c.useMemo(()=>{const i=l.filter(({data:h})=>h.isAccount),{credit:p,debit:f}=Object.groupBy(i,({data:h})=>h.isExpense?"debit":"credit");if(!p||!f)return 0;const C=g(p.map(({data:{transactions:h}})=>g(h))),T=g(f.map(({data:{transactions:h}})=>g(h)));return C-Math.abs(T)},[l]);if(t.length===0)return e.jsx(M,{variant:"info",children:"Transaction Missing, please upload for the month"});const m=e.jsxs("span",{children:[e.jsx("strong",{children:x(d)})," saved"]}),j=e.jsxs("span",{children:["Spent ",e.jsx("strong",{children:x(d)})," more than total income"]});return e.jsxs(e.Fragment,{children:[e.jsxs(k,{className:"mb-3",children:[e.jsx(b,{children:e.jsx("h5",{children:e.jsx(v,{bg:d>0?"info":"warning",children:d>0?m:j})})}),e.jsx(b,{children:e.jsx(F,{style:{float:"right",cursor:"pointer"},onClick:()=>{n(i=>!i)}})})]}),e.jsx("div",{children:l.length>0&&e.jsx(z,{isDragDisabled:o,isDropDisabled:o,items:l,onDragEnd:i=>{r(i)},children:({title:i,total:p,transactions:f})=>e.jsx(K,{title:i,total:p,transactions:f})})})]})},[X,...D]=O,Z=()=>{const[s,a]=c.useState(D[0].label.toLowerCase()),{month:o,year:n}=c.useMemo(()=>{const t=new Date;return t.setMonth(t.getMonth()-1),{month:t.getMonth(),year:t.getFullYear().toString()}},[]);return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Monthly Expense Report"}),e.jsx(w,{activeKey:s,onSelect:t=>a(t),className:"mb-3",children:D.map(({label:t,value:l},r)=>e.jsx(R,{eventKey:t.toLowerCase(),title:t,disabled:r>o,unmountOnExit:!0,children:e.jsx(P,{month:l,year:n})},l))})]})};export{Z as default};
