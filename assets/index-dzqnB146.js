import{z as w,u as f,y as F,r,j as e,q as v,s as g,F as N,w as D}from"./vendor-BC_dpYi7.js";import{f as M}from"./NumberUtils-DGiqd6yw.js";import{T as Y,s as _}from"./index-C7imb_n_.js";import{h as $,a as Q,b as B,G as K}from"./ApiBase-DXA55t6X.js";import{Q as x,E as A,w as P}from"./index-BxcUTzTY.js";const W=(c,o,a,n,t)=>[{headerName:"Name",field:"name"},{headerName:"Transactions",field:"matchers",cellRenderer:"listItemWithEditCellRenderer",cellRendererParams:{updateItem:a},valueFormatter:({value:l})=>l==null?void 0:l.join(""),minWidth:350,autoHeight:!0},{headerName:"Budget",field:"budget",minWidth:100,valueFormatter:({value:l})=>l?M(Number(l),!0,0):" "},{headerName:"Chart Color",field:"chartColor",minWidth:110,cellStyle:({value:l})=>({backgroundColor:l??"inherit",color:"white"})},{headerName:"Transaction Source",field:"sourceId",valueFormatter:({value:l})=>{var C;return((C=t==null?void 0:t.find(p=>p.id===l))==null?void 0:C.name)??"Source Not Found"}},{headerName:"Action",type:"rightAligned",minWidth:140,cellRenderer:"rowActionCellRenderer",cellRendererParams:{deleteItem:c,toggleItem:o,editItem:n}}],z=()=>w({queryKey:x.CATEGORY_SETTINGS,meta:{endpoint:A.CATEGORY_SETTINGS}}),H=()=>{var a,n;const c=f(),o=(n=(a=c.getDefaultOptions().queries)==null?void 0:a.meta)==null?void 0:n.baseUrl;return F({mutationFn:t=>$(`${o}${A.CATEGORY_SETTINGS}`,t),onSuccess:()=>{c.invalidateQueries({queryKey:x.CATEGORY_SETTINGS})}})},J=()=>{var a,n;const c=f(),o=(n=(a=c.getDefaultOptions().queries)==null?void 0:a.meta)==null?void 0:n.baseUrl;return F({mutationFn:t=>Q(`${o}${A.CATEGORY_SETTINGS}/${t.id}`,t.payload),onSuccess:()=>{c.invalidateQueries({queryKey:x.CATEGORY_SETTINGS})}})},L=()=>{var a,n;const c=f(),o=(n=(a=c.getDefaultOptions().queries)==null?void 0:a.meta)==null?void 0:n.baseUrl;return F({mutationFn:t=>B(`${o}${A.CATEGORY_SETTINGS}/${t}`),onSuccess:()=>{c.invalidateQueries({queryKey:x.CATEGORY_SETTINGS})}})};function V(){const c=f(),o=z(),a=H(),n=L(),t=J(),l=c.getQueryData(x.SOURCE_SETTINGS),C=r.useCallback(async(d,i,S,u,y)=>a.mutateAsync({name:i,matchers:d,chartColor:S,sourceId:u,budget:y}),[a]),p=r.useCallback(async d=>n.mutateAsync(d.id),[n]),T=r.useCallback(async d=>t.mutateAsync({id:d.id,payload:{isEnabled:!d.isEnabled}}),[t]),j=r.useCallback(async(d,i,S,u,y,h)=>t.mutateAsync({id:d,payload:{name:S,matchers:i,chartColor:u,sourceId:y,budget:h}}),[t]),m=r.useCallback(async(d,i)=>t.mutateAsync({id:d.id,payload:{matchers:i}}),[t]);return{categories:o.data,sourceList:l,error:a.error||t.error||n.error,onSave:C,onDelete:p,onUpdate:j,onToggleStatus:T,onUpdateTransactions:m}}const X=()=>{const{categories:c,sourceList:o,error:a,onDelete:n,onSave:t,onUpdate:l,onToggleStatus:C,onUpdateTransactions:p}=V(),[T,j]=r.useState(null),[m,d]=r.useState([]),[i,S]=r.useState("#FFFFFF"),[u,y]=r.useState(""),[h,G]=r.useState(""),[b,R]=r.useState(""),E=r.useCallback(()=>{j(null),d([]),y(""),S(""),G(""),R("")},[]),O=r.useCallback(()=>{t(m,u,i,h,parseInt(b)).then(()=>{E()})},[t,m,u,i,h,b,E]),k=r.useCallback(()=>{l(T,m,u,i,h,parseInt(b)).then(()=>{E()})},[l,T,m,u,i,h,b,E]),U=r.useCallback(s=>{var I;j(s.id),d(s.matchers),y(s.name),S(s.chartColor),G(s.sourceId),R(((I=s.budget)==null?void 0:I.toString())||"")},[]),q=r.useMemo(()=>W(n,C,p,U,o),[U,n,C,p,o]);return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Category Settings"}),e.jsxs(v,{className:"mb-2",children:[e.jsx(g,{children:e.jsx(N.Control,{placeholder:"Enter Label",value:u,onChange:s=>y(s.target.value)})}),e.jsx(g,{children:e.jsx(Y,{selected:m,options:m,onChange:d})}),e.jsx(g,{sm:2,children:e.jsx(N.Control,{placeholder:"Enter Budget",type:"number",step:"any",min:"1",value:b,onChange:s=>R(s.target.value)})}),e.jsx(g,{sm:1,children:e.jsx(N.Control,{type:"color",value:i,onChange:s=>S(s.target.value),title:"Choose your color"})}),e.jsx(g,{children:e.jsxs(N.Select,{"aria-label":"Source Selector",value:h,onChange:s=>G(s.target.value),children:[e.jsx("option",{children:"Select Source"}),o==null?void 0:o.map((s,I)=>e.jsx("option",{value:s.id,children:s.name},`source-${I}`))]})})]}),e.jsx(v,{children:e.jsxs(g,{className:"text-end",children:[e.jsx(D,{className:"mx-2",disabled:!u||m.length===0||!i||!h,onClick:T?k:O,children:T?"Update":"Add Category"}),e.jsx(D,{variant:"outline-secondary",onClick:E,children:"Clear"})]})}),e.jsx(v,{children:e.jsxs(g,{children:[e.jsx("p",{children:a==null?void 0:a.error}),e.jsx(K,{colDefs:q,rowData:c,components:_})]})})]})},se=P(X);export{X as CategorySettings,se as default};
