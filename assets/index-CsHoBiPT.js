import{j as e,q as b,F as D,T as E,B as A,r as l,s as M,v as F,D as R,P as k,A as y,R as I,w as N,x as v}from"./vendor-Dobm3Lbi.js";import{u as w,g as B,t as f,M as L,L as _}from"./TransactionUtils-BlVV5WVC.js";import{G as H}from"./ApiBase-DjuaOdbS.js";import{f as h}from"./NumberUtils-DGiqd6yw.js";import"./index-C2PfOp2L.js";const O={sortable:!0},Y=[{headerName:"Category",field:"categoryName"},{headerName:"Budget",field:"amount",minWidth:100,type:"rightAligned",valueFormatter:s=>h(parseInt(s.value??"0"),!1)},{headerName:"Amount",field:"amount",minWidth:100,type:"rightAligned",valueFormatter:s=>h(parseInt(s.value??"0"),!1)}],q=({transactionList:s})=>e.jsx(H,{rowHeight:25,styles:{height:"212px"},defaultColDef:O,colDefs:Y,rowData:s,pagination:!1}),{Title:z}=E,C=({height:s="250px",body:t,children:a,actionText:n,onClick:i})=>e.jsx(b,{className:"summary-tile-fill",style:{height:s,boxShadow:"#3399F3 5px 5px 5px"},title:t==null?void 0:t.title,size:"small",extra:n?e.jsx(A,{type:"link",block:!0,onClick:i,children:n}):null,children:t!=null&&t.text?e.jsx(D,{align:"center",justify:"center",vertical:!0,style:{padding:"3.7em"},children:e.jsx(z,{level:2,children:t==null?void 0:t.text})}):a}),G=({title:s,total:t,transactions:a})=>{const[n,i]=l.useState(!1),o=l.useCallback(()=>{i(!n)},[n]),r=h(t,!1);return e.jsxs(M,{isFlipped:n,children:[e.jsx(C,{body:{title:s,text:r},actionText:"Breakdown",onClick:o}),e.jsx(C,{actionText:"Summary",onClick:o,children:e.jsx(q,{transactionList:a})})]})},W=({children:s,...t})=>{const[a,n]=l.useState(!1);return l.useEffect(()=>{const i=requestAnimationFrame(()=>n(!0));return()=>{cancelAnimationFrame(i),n(!1)}},[]),a?e.jsx(F,{...t,children:s}):null},P=(s,t)=>({background:t?"unset":s?"lightblue":"lightgrey",display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gridTemplateRows:"repeat(2, 250px)",gap:"10px 5px",justifyItems:"stretch"}),V=({children:s,items:t,onDragEnd:a,isDropDisabled:n,isDragDisabled:i})=>{const o=l.useCallback(r=>{if(!r.destination)return;const c=Array.from(t),[d]=c.splice(r.source.index,1);c.splice(r.destination.index,0,d),a(c)},[t,a]);return e.jsx(R,{onDragEnd:o,children:e.jsx(W,{isDropDisabled:n,droppableId:"droppable",direction:"horizontal",children:(r,c)=>e.jsxs("div",{className:"p-2",ref:r.innerRef,style:P(c.isDraggingOver,n),...r.droppableProps,children:[t.map((d,j)=>e.jsx(k,{isDragDisabled:i,draggableId:d.id,index:j,children:x=>e.jsx("div",{ref:x.innerRef,...x.draggableProps,...x.dragHandleProps,children:s(d.data)})},d.id)),r.placeholder]})})})},J=({year:s,month:t})=>{const[a,n]=l.useState(!0),[i,{isLoading:o}]=w(s,t),[r,c]=l.useState([]);l.useEffect(()=>{i&&c(B(i).map((p,m)=>({id:"item"+m,data:p})))},[i]);const d=l.useMemo(()=>{const p=r.filter(({data:u})=>u.isAccount),{credit:m,debit:g}=Object.groupBy(p,({data:u})=>u.isExpense?"debit":"credit");if(!m||!g)return 0;const T=f(m.map(({data:{transactions:u}})=>f(u))),S=f(g.map(({data:{transactions:u}})=>f(u)));return T-Math.abs(S)},[r]);if(i.length===0&&!o)return e.jsx(y,{type:"info",message:"Transaction Missing, please upload for the month"});const j=e.jsxs("span",{children:[e.jsx("strong",{children:h(d)})," saved"]}),x=e.jsxs("span",{children:["Spent ",e.jsx("strong",{children:h(d)})," more than total income"]});return e.jsxs(D,{gap:16,vertical:!0,children:[e.jsx(y,{type:d>0?"info":"warning",message:e.jsxs(D,{align:"center",justify:"space-between",children:[e.jsx("span",{children:d>0?j:x}),e.jsx(I,{onClick:()=>{n(p=>!p)}})]})}),r.length>0&&e.jsx(V,{isDragDisabled:a,isDropDisabled:a,items:r,onDragEnd:p=>{c(p)},children:({title:p,total:m,transactions:g})=>e.jsx(G,{title:p,total:m,transactions:g})})]})},[te,...K]=L,[se,...Q]=_,ae=()=>{const{month:s,year:t}=l.useMemo(()=>{const o=new Date;return o.setMonth(o.getMonth()+1),{month:o.getMonth(),year:o.getFullYear()}},[]),[a,n]=l.useState(t),i=l.useMemo(()=>K.map(({id:o,label:r,value:c})=>({key:o,label:r,children:e.jsx(J,{month:c,year:a}),disabled:a===t?parseInt(c)>s:!1})),[s,t,a]);return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Monthly Expense Report"}),e.jsx(N,{tabBarExtraContent:e.jsx(v,{defaultValue:a,onChange:n,options:Q}),items:i})]})};export{ae as default};
