import{r as o,j as e,B as S,y as w,b as F,z as A,E as r,x as C,U as b,G as U,A as y,a as j,C as u}from"./vendor-Dobm3Lbi.js";import{f as N,u as E,a as M,b as R,A as P,C as k,c as D,L as _,M as B}from"./TransactionUtils-BlVV5WVC.js";import{G as L}from"./ApiBase-DjuaOdbS.js";import"./index-C2PfOp2L.js";const O={account:"Account",creditCard:"Credit Card"},Y={filter:!0,sortable:!0},I=()=>[{headerName:"Date",field:"date",filter:"agDateColumnFilter",minWidth:120,valueFormatter:a=>N(a.value)},{headerName:"From",field:"accountType",minWidth:120,valueFormatter:a=>O[a.value]},{headerName:"Transaction",field:"transactionSource",minWidth:500},{headerName:"Amount",field:"amount",filter:"agNumberColumnFilter"},{headerName:"Category",field:"category",valueFormatter:a=>{var t;return((t=a.value)==null?void 0:t.name)??""}},{headerName:"Source",field:"source",valueFormatter:a=>{var t;return((t=a.value)==null?void 0:t.name)??""}}],G=({month:a,year:t})=>{const[n]=E(t,a),s=o.useMemo(()=>I(),[]);return e.jsx(L,{defaultColDef:Y,colDefs:s,rowData:n})},V=({modalTitle:a,buttonText:t,children:n,onPrimaryAction:s,primaryButtonText:i,isLoading:p})=>{const[h,l]=o.useState(!1),m=()=>l(!1),x=()=>l(!0),f=o.useCallback(()=>{s(m)},[s]);return e.jsxs(e.Fragment,{children:[e.jsx(S,{type:"primary",onClick:x,children:t}),e.jsx(w,{title:a,open:h,onOk:f,okText:i,onCancel:m,cancelText:"Close",children:e.jsx(F,{percent:100,spinning:p,children:n})})]})},W=a=>new Promise((t,n)=>{A.parse(a,{skipEmptyLines:!0,complete:s=>{if(s.errors.length>0)n(s.errors);else{const i=M(s.data);t(i)}}})}),z=()=>{const[a]=r.useForm(),[t,n]=o.useState([]),{mutateAsync:s,isPending:i,isSuccess:p,isError:h}=R(),[l,m]=o.useState(""),x=o.useCallback(async d=>{if(t.length>0&&l){const c=await W(t[0].originFileObj);await s({accountType:l,payload:c}),d()}else alert("Please select file to upload")},[t,l,s]),f=o.useCallback(d=>{n(c=>{const v=c.indexOf(d),T=c.slice();return T.splice(v,1),T})},[]),g=o.useCallback(d=>(n(c=>[...c,d]),!1),[]);return e.jsxs(V,{modalTitle:"Upload Latest Transactions",buttonText:"Upload new transaction CSV",primaryButtonText:"Upload",onPrimaryAction:x,isLoading:i,children:[e.jsxs(r,{form:a,name:"upload-form",layout:"vertical",children:[e.jsx(r.Item,{name:"accountType",label:"Account type for transactions",children:e.jsx(C,{placeholder:"Account Type",value:l,options:P,onChange:m,allowClear:!0})}),e.jsx(r.Item,{layout:"horizontal",name:"file",label:"Select CSV file",children:e.jsx(b,{accept:"text/csv",maxCount:1,fileList:t,onRemove:f,beforeUpload:g,children:e.jsx(S,{disabled:t.length>0,icon:e.jsx(U,{}),children:"Select File"})})})]}),p&&e.jsx(y,{type:"success",message:`Successfully uploaded ${l} transactions`}),h&&e.jsx(y,{type:"error",message:"Something went wrong while uploading transaction, try again later"})]})},K=()=>{const[a,t]=o.useState(k.value),[n,s]=o.useState(D.value);return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Transactions"}),e.jsxs(j,{align:"middle",justify:"space-between",children:[e.jsx(u,{span:4,children:e.jsxs(j,{align:"middle",justify:"space-between",children:[e.jsx(u,{span:11,children:e.jsx(r.Item,{children:e.jsx(C,{placeholder:"Year selection",value:a,options:_,onChange:t,allowClear:!0})})}),e.jsx(u,{span:11,children:e.jsx(r.Item,{children:e.jsx(C,{placeholder:"Month Selection",value:n,options:B,onChange:s,allowClear:!0})})})]})}),e.jsx(u,{flex:"none",span:4,children:e.jsx(r.Item,{children:e.jsx(z,{})})})]}),e.jsx(j,{children:e.jsx(u,{span:24,children:a&&n&&e.jsx(G,{month:n,year:a})})})]})};export{K as default};
