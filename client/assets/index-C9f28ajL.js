import{I as B,f as j,H as G,r as n,W as A,j as e,q as Q,a as O,C as w,F as U,E as T,X as $,x as k,Y as P,Z as K,B as D}from"./vendor-Dobm3Lbi.js";import{f as H}from"./NumberUtils-DGiqd6yw.js";import{s as z}from"./index-RR0uIUn3.js";import{h as X,a as Z,b as J,G as V}from"./ApiBase-DjuaOdbS.js";import{Q as I,E as f,w as L}from"./index-C2PfOp2L.js";const ee=(i,o,a,r,t)=>[{headerName:"Name",field:"name"},{headerName:"Transactions",field:"matchers",cellRenderer:"listItemWithEditCellRenderer",cellRendererParams:{updateItem:a},valueFormatter:({value:l})=>l==null?void 0:l.join(""),minWidth:350,autoHeight:!0},{headerName:"Budget",field:"budget",minWidth:150,maxWidth:150,valueFormatter:({value:l})=>l?H(Number(l),!0,0):" "},{headerName:"Chart Color",field:"chartColor",minWidth:150,maxWidth:150,cellStyle:({value:l})=>({backgroundColor:l??"inherit",color:"white"})},{headerName:"Transaction Source",field:"sourceId",valueFormatter:({value:l})=>{var h;return((h=t==null?void 0:t.find(g=>g.id===l))==null?void 0:h.name)??"Source Not Found"}},{headerName:"Action",type:"rightAligned",minWidth:150,maxWidth:150,suppressAutoSize:!0,suppressSizeToFit:!0,sortable:!1,cellRenderer:"rowActionCellRenderer",cellRendererParams:{deleteItem:i,toggleItem:o,editItem:r}}],te=()=>B({queryKey:I.CATEGORY_SETTINGS,meta:{endpoint:f.CATEGORY_SETTINGS}}),ae=()=>{var a,r;const i=j(),o=(r=(a=i.getDefaultOptions().queries)==null?void 0:a.meta)==null?void 0:r.baseUrl;return G({mutationFn:t=>X(`${o}${f.CATEGORY_SETTINGS}`,t),onSuccess:()=>{i.invalidateQueries({queryKey:I.CATEGORY_SETTINGS})}})},se=()=>{var a,r;const i=j(),o=(r=(a=i.getDefaultOptions().queries)==null?void 0:a.meta)==null?void 0:r.baseUrl;return G({mutationFn:t=>Z(`${o}${f.CATEGORY_SETTINGS}/${t.id}`,t.payload),onSuccess:()=>{i.invalidateQueries({queryKey:I.CATEGORY_SETTINGS})}})},ne=()=>{var a,r;const i=j(),o=(r=(a=i.getDefaultOptions().queries)==null?void 0:a.meta)==null?void 0:r.baseUrl;return G({mutationFn:t=>J(`${o}${f.CATEGORY_SETTINGS}/${t}`),onSuccess:()=>{i.invalidateQueries({queryKey:I.CATEGORY_SETTINGS})}})};function re(){const i=j(),o=te(),a=ae(),r=ne(),t=se(),l=i.getQueryData(I.SOURCE_SETTINGS),h=n.useCallback(async(d,u,C,m,p)=>a.mutateAsync({name:u,matchers:d,chartColor:C,sourceId:m,budget:p}),[a]),g=n.useCallback(async d=>r.mutateAsync(d.id),[r]),y=n.useCallback(async d=>t.mutateAsync({id:d.id,payload:{isEnabled:!d.isEnabled}}),[t]),E=n.useCallback(async(d,u,C,m,p,S)=>t.mutateAsync({id:d,payload:{name:C,matchers:u,chartColor:m,sourceId:p,budget:S}}),[t]),c=n.useCallback(async(d,u)=>t.mutateAsync({id:d.id,payload:{matchers:u}}),[t]);return{categories:o.data,sourceList:l,error:a.error||t.error||r.error,onSave:h,onDelete:g,onUpdate:E,onToggleStatus:y,onUpdateTransactions:c}}const oe=()=>{const{categories:i,sourceList:o,error:a,onDelete:r,onSave:t,onUpdate:l,onToggleStatus:h,onUpdateTransactions:g}=re(),[y,E]=n.useState(null),[c,d]=n.useState([]),[u,C]=n.useState(new A("#FFFFFF")),[m,p]=n.useState(""),[S,F]=n.useState(""),[b,N]=n.useState(null),x=n.useCallback(()=>{E(null),d([]),p(""),C(new A("#FFFFFF")),F(""),N("")},[]),q=n.useCallback(()=>{t(c,m,u.toHexString(),S,parseInt(b??"")).then(()=>{x()})},[t,c,m,u,S,b,x]),M=n.useCallback(()=>{l(y,c,m,u.toHexString(),S,parseInt(b??"")).then(()=>{x()})},[l,y,c,m,u,S,b,x]),R=n.useCallback(s=>{var v;E(s.id),d(s.matchers),p(s.name),C(new A(s.chartColor)),F(s.sourceId),N(((v=s.budget)==null?void 0:v.toString())||"")},[]),Y=n.useMemo(()=>ee(r,h,g,R,o),[R,r,h,g,o]),_=n.useMemo(()=>(o==null?void 0:o.map(s=>({value:s.id,label:s.name})))??[],[o]),W=n.useMemo(()=>c.map(s=>({label:s,value:s})),[c]);return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Category Settings"}),e.jsx(Q,{children:e.jsxs(O,{justify:"space-between",align:"middle",wrap:!1,children:[e.jsx(w,{span:16,children:e.jsxs(U,{gap:"middle",justify:"space-between",wrap:!0,children:[e.jsx(T.Item,{label:"Enter Name",children:e.jsx($,{value:m,onChange:s=>p(s.target.value)})}),e.jsx(T.Item,{label:"Select  Transactions",children:e.jsx(k,{mode:"tags",style:{width:"400px"},placeholder:"Select transactions",onChange:d,options:W,value:c})}),e.jsx(T.Item,{label:"Enter Budget",children:e.jsx(P,{min:"1",step:"any",value:b,onChange:s=>N(s)})}),e.jsx(T.Item,{label:"Choose your color",children:e.jsx(K,{value:u,onChange:C})}),e.jsx(T.Item,{label:"Select Source",style:{width:"300px"},children:e.jsx(k,{options:_,onChange:s=>F(s.value)})})]})}),e.jsx(w,{span:4,children:e.jsxs(U,{gap:"middle",justify:"end",wrap:!0,children:[e.jsx(D,{disabled:!m||c.length===0||!u||!S,onClick:y?M:q,children:y?"Update":"Add Category"}),e.jsx(D,{onClick:x,children:"Clear"})]})})]})}),e.jsx(O,{children:e.jsxs(w,{span:24,children:[e.jsx("p",{children:a==null?void 0:a.error}),e.jsx(V,{colDefs:Y,rowData:i,components:z})]})})]})},me=L(oe);export{oe as CategorySettings,me as default};
